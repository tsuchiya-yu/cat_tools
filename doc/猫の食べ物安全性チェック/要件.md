## 新機能「猫の食べ物安全性チェック」の要件定義書

### 1. 目的
飼い主が日常的に食べる食材の中から、猫に与えても安全かどうかを瞬時に確認できる機能を提供する。猫の健康を守り、誤食事故を防止することを目的とする。

### 2. 背景
既存の「ねこツールズ」では年齢・カロリー・給餌量計算といった基礎的なツールが提供されているが、食べ物の安全性について調べる機能はない。先に作成した 200 種類の食材データ（安全・注意・危険の分類、理由、補足情報）を活用し、ユーザーが食材名を入力すると安全性を判定できるようにする。

### 3. ユーザーストーリー
- **US1**: 飼い主として、与えようとしている食材が猫に安全かどうかを知りたいので、食材名を入力して安全性を確認できるようにしたい。
- **US2**: 飼い主として、食材が危険な場合にはその理由や症状、緊急時の対処方法も知りたい。
- **US3**: ツール利用者として、入力した食材がデータに存在しない場合でも、分かりやすく「情報がないこと」を伝えてほしい。
- **US4**: ツール利用者として、判定結果を家族や友人と簡単に共有したい。

### 4. 機能要件

#### 4.1 データ取り込み
- JSON ファイル `cat_foods.json`（200 件の食材リスト）をリポジトリに追加する。`/public/data` など静的配信可能な場所に置く。
- TypeScript の型定義を作成し、`name`・`status`・`description`・`notes` を持つ型を定義する。

#### 4.2 ロジック (`src/lib/catFoodSafety.ts` 等)
- JSON データを読み込み、名前で検索する純粋関数 `searchCatFood(name: string): CatFoodResult | null` を実装する。
  - 大文字小文字を区別せず、全角／半角やカタカナ／ひらがな変換を考慮する。
  - 部分一致検索をサポートし、候補が複数ある場合はすべて返却する。
- 該当する食材がない場合は `null` を返す。

#### 4.3 UI ページ (`src/app/cat-food-safety/page.tsx` など)
- ナビゲーション画面のツール一覧に「猫の食べ物安全性チェック」を追加し、クリックするとこのページへ遷移する。
- ページ構成：
  1. **ヘッダー**: タイトルと簡単な説明文。
  2. **入力フォーム**: テキスト入力欄と検索ボタン。入力時に `Enter` キーで検索開始できるようにする。
  3. **結果表示領域**:
     - ヒットした食材ごとに、`name`・`status`・`description`・`notes` を表示。
     - `status` によって表示スタイルを変える（安全＝緑、注意＝オレンジ、危険＝赤など）。
     - データが存在しない場合は「該当データがありません」と表示。
  4. **共有機能**: URL と結果テキストをクリップボードにコピーするボタン、X（Twitter）共有ボタンを提供。
- アクセシビリティを確保し、ラベル付けやフォーカス管理、色覚多様性を考慮する。
- `src/constants/text.ts` に新ページ用の META 情報（title, description, keywords, og:image など）と UI 文言（フォームラベル、ボタン名、注意文言）を追加する。

#### 4.4 バリデーション
- 入力が空の場合は検索を実行せず、「食材名を入力してください」というメッセージを表示。
- 極端に長い文字列や特殊文字は適切にエスケープし、検索対象外とする。

#### 4.5 テスト
- **ユニットテスト**: `searchCatFood` 関数について、正常に食材を取得できること、部分一致や存在しない場合の挙動を検証する。
- **E2E テスト**: Playwright を用いてページ遷移、UI の表示、検索結果や共有機能が動作することを検証する。

### 5. 非機能要件
- **パフォーマンス**: データ数は 200 件程度であり、クライアントサイド読み込みで十分高速に動作すること。
- **レスポンシブ対応**: スマートフォン／タブレット／PC での表示最適化。
- **アクセシビリティ**: 入力欄・ボタンのラベル付け、ARIA 属性、キーボード操作への対応、色コントラストの確保。
- **国際化**: 将来的な多言語対応を考慮し、テキストは定数ファイルにまとめる。
- **SEO**: 新ページにも OGP メタ情報や構造化データを設定する。
- **セキュリティ**: ユーザー入力に対して XSS のリスクを排除するため、表示する内容を適切にエスケープする。

### 6. 移行とデプロイ計画
1. `cat_foods.json` をリポジトリに追加し、必要なら自動生成スクリプトを記載する。
2. `src/lib/catFoodSafety.ts` を追加し、検索関数を実装。
3. 新ページ `src/app/cat-food-safety` を作成し、既存ページのパターンに倣ってコンポーネントを組み立てる。
4. `src/constants/text.ts` やツール一覧定義にメタ情報とツール名を追加。
5. 単体テスト・E2E テストを実装し、既存テストが失敗しないことを確認。
6. ブランチを切ってレビュー・マージし、Vercel などの自動デプロイで本番環境に反映する。
