<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>猫のカロリー計算｜体重から1日の必要カロリーを自動計算</title>
  <meta name="description" content="体重といくつかの簡単な選択だけで、猫の1日の必要カロリー（kcal/日）を自動計算。結果は中心値と参考幅で表示します。">
  <link rel="canonical" href="https://cat-tools.catnote.tokyo/calculate-cat-calorie">

  <!-- OGP（後で差し替え可） -->
  <meta property="og:title" content="猫のカロリー計算">
  <meta property="og:description" content="体重から猫の1日の必要カロリーを自動計算。結果は中心値＋参考幅で表示。">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://cat-tools.catnote.tokyo/og-cat-calorie.png">
  <meta property="og:locale" content="ja_JP">
  <meta name="twitter:card" content="summary_large_image">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400..700&family=Outfit:wght@600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary:#FF69B4; --primary-strong:#E00070;
      --text:#111; --muted:#666; --border:#E9E9EA;
      --r-sm:8px; --r-md:12px; --r-lg:16px; --r-xl:24px;
      --s-1:8px; --s-2:16px; --s-3:24px; --s-4:40px;
      --ring:0 0 0 2px rgba(224,0,112,.35);
    }
    *,*::before,*::after{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0; background:#fff; color:var(--text);
      font-family:"Zen Kaku Gothic New","Noto Sans JP",-apple-system,system-ui,Segoe UI,Meiryo,sans-serif;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    .container{ max-width:760px; margin:0 auto; padding:0 var(--s-3) var(--s-4) }

    .eyebrow{ font-size:14px; letter-spacing:.08em; text-transform:uppercase; color:rgba(224,0,112,.85); margin-top:var(--s-3) }
    h1{ font-size:32px; line-height:1.25; font-weight:700; margin:.4rem 0 0 }
    @media (min-width:768px){ h1{ font-size:40px; line-height:1.2 } }
    .lead{ font-size:14px; color:var(--muted); margin:.6rem 0 var(--s-3); line-height:1.7 }
    .section{ margin-top:var(--s-4) }
    .label{ font-size:18px; font-weight:700; color:#111 }

    /* 入力エリア：下線で区切り */
    .surface{
      padding:var(--s-3);
      border:none; border-radius:0;
      border-bottom:1px solid var(--border);
      overflow:hidden;
    }
    .row{ display:flex; flex-direction:column; gap:var(--s-2); margin-top:var(--s-2) }

    input[type="number"]{
      width:100%; height:56px; padding:0 var(--s-3);
      border:2px solid #F0C7D8; border-radius:var(--r-xl);
      font-size:16px; color:var(--text); background:#fff;
    }
    input:focus-visible{ outline:none; box-shadow:var(--ring) }
    .help{ font-size:13px; color:#808080; margin-top:4px }

    /* セグメント（ボタン切替） */
    .seg{ display:flex; gap:8px; flex-wrap:wrap }
    .seg button{
      appearance:none; border:1px solid #E5E7EB; background:#fff; color:#111;
      padding:10px 14px; border-radius:999px; cursor:pointer; font-size:14px; font-weight:600;
    }
    .seg button[aria-pressed="true"]{
      border-color:var(--primary-strong); color:#fff; background:var(--primary-strong);
    }

    /* トグル */
    .switch{ display:flex; align-items:center; gap:10px }
    .switch input{ appearance:none; width:44px; height:26px; border-radius:999px; background:#E5E7EB; position:relative; cursor:pointer; outline:none; border:none }
    .switch input::after{
      content:""; position:absolute; left:3px; top:3px; width:20px; height:20px; border-radius:50%; background:#fff; transition:left .15s ease;
      box-shadow:0 1px 2px rgba(0,0,0,.2);
    }
    .switch input:checked{ background:var(--primary-strong) }
    .switch input:checked::after{ left:21px }
    .switch label{ font-size:14px; color:#111 }

    /* 結果表示 */
    .result{ text-align:center; position:relative; padding-top:8px; padding-bottom:var(--s-3); border-bottom:1px solid var(--border) }
    .result .muted{ color:var(--muted); margin-bottom:6px; letter-spacing:.04em }
    .numeral{
      font-family:"Outfit",ui-sans-serif,system-ui,-apple-system,"Helvetica Neue",Arial,sans-serif;
      font-variant-numeric:tabular-nums; letter-spacing:-.01em;
    }
    .big{ display:flex; align-items:baseline; justify-content:center; gap:14px; font-size:0; flex-wrap:wrap }
    .age-group{ display:flex; align-items:baseline; gap:6px }
    .age-group .numeral{ font-size:72px; font-weight:800; color:var(--primary-strong) }
    .age-group .unit{ font-size:20px; color:#111; position:relative; top:-10px }
    @media (max-width:480px){
      .age-group .numeral{ font-size:56px }
      .age-group .unit{ font-size:18px; top:-8px }
    }

    .grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:0; margin-top:18px }
    .cell{ background:transparent; border-left:1px solid #F0C7D8; padding:14px 16px }
    .cell:first-child{ border-left:none }
    .cell .k{ font-size:12px; text-transform:uppercase; letter-spacing:.04em; color:#808080; text-align:center }
    .cell .v{ font-weight:700; font-size:16px; text-align:center; margin-top:6px; word-break:keep-all }

    .error{ color:#b00020; font-size:13px; margin-top:6px; min-height:1.2em }

    /* 共有ボタン＋メニュー */
    .share-btn{
      position:absolute; right:0; top:0; transform:translateY(-60%);
      width:40px; height:40px; border-radius:999px; border:1px solid #D7DADF;
      background:#fff; display:inline-grid; place-items:center; cursor:pointer;
    }
    .share-btn:hover{ border-color:#B7BBC3 }
    .share-menu{
      position:absolute; right:0; top:0; transform:translateY(-10%); z-index:20;
      background:#fff; border:1px solid #E5E7EB; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.08);
      padding:6px; display:none; min-width:220px;
    }
    .share-menu.open{ display:block }
    .share-item{
      display:flex; align-items:center; gap:10px; width:100%;
      padding:10px 12px; border-radius:8px; background:#fff; color:#111; text-decoration:none; cursor:pointer;
    }
    .share-item:hover{ background:#F8F9FB }
    .share-item svg{ flex-shrink:0 }

    .section-title{ margin-top:var(--s-4); padding-top:var(--s-2); border-top:1px solid var(--border); font-weight:800; font-size:24px; letter-spacing:-.01em }
    details{ border:none; border-top:1px solid #eee; padding:18px 0 }
    details+details{ margin-top:0 }
    summary{ list-style:none; cursor:pointer; display:flex; align-items:center; justify-content:space-between; font-weight:400; color:#111 }
    summary::-webkit-details-marker{ display:none }
    summary:hover{ color:var(--primary-strong) }
    .chev{ transition:transform .15s ease }
    details[open] .chev{ transform:rotate(180deg) }

    .toast{
      position:fixed; left:50%; bottom:24px; transform:translateX(-50%);
      background:#111; color:#fff; font-size:14px; padding:10px 14px; border-radius:10px;
      opacity:0; pointer-events:none; transition:opacity .18s ease;
    }
    .toast.show{ opacity:1 }

    footer{ color:#888; font-size:13px; margin-top:var(--s-4) }
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }
  </style>
</head>
<body>
  <main class="container">
    <!-- Hero -->
    <section class="section">
      <p class="eyebrow">猫のカロリーをかんたん計算</p>
      <h1>猫のカロリー計算</h1>
      <p class="lead">体重といくつかの選択だけで、1日の必要カロリー（kcal/日）を表示します。結果は中心値と参考幅で出るので、むずかしい設定は不要です。</p>

      <div class="surface">
        <div class="label">入力</div>
        <div class="row">
          <!-- 体重 -->
          <div>
            <label class="sr-only" for="w">体重(kg)</label>
            <input id="w" type="number" step="0.1" min="0.5" placeholder="体重 (kg)">
            <div class="help">例: 4.2</div>
          </div>

          <!-- ライフステージ -->
          <div>
            <div class="help" style="margin-bottom:6px">ライフステージ</div>
            <div class="seg" role="tablist" aria-label="ライフステージ">
              <button id="st-kitten" class="seg-btn" data-stage="kitten" aria-pressed="false">子猫</button>
              <button id="st-adult"  class="seg-btn" data-stage="adult" aria-pressed="true">成猫</button>
              <button id="st-senior" class="seg-btn" data-stage="senior" aria-pressed="false">シニア</button>
            </div>
          </div>

          <!-- 去勢/避妊（成猫のみ表示） -->
          <div class="switch" id="neuteredWrap">
            <input id="neutered" type="checkbox" checked aria-label="去勢・避妊済み">
            <label for="neutered">去勢/避妊済み（成猫のみ）</label>
          </div>

          <!-- 目標 -->
          <div>
            <div class="help" style="margin-bottom:6px">目標</div>
            <div class="seg" role="tablist" aria-label="目標">
              <button id="gl-maintain" class="seg-btn" data-goal="maintain" aria-pressed="true">維持</button>
              <button id="gl-loss"     class="seg-btn" data-goal="loss" aria-pressed="false">減量したい</button>
              <button id="gl-gain"     class="seg-btn" data-goal="gain" aria-pressed="false">増量したい</button>
            </div>
          </div>
        </div>

        <div id="error" class="error" role="alert" aria-live="polite"></div>
      </div>
    </section>

    <!-- Result -->
    <section id="resultSection" class="section" aria-live="polite">
      <div class="result">
        <div class="muted">1日の必要カロリー</div>

        <div class="big">
          <span class="age-group">
            <span id="kcal" class="numeral">--</span><span class="unit">kcal/日</span>
          </span>
        </div>

        <!-- 共有ボタン -->
        <button id="shareBtn" class="share-btn" aria-haspopup="menu" aria-expanded="false" aria-label="共有メニューを開く">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#69707D" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M4 12v7a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-7"/><path d="M12 16V4"/><path d="M8 8l4-4 4 4"/>
          </svg>
        </button>
        <div id="shareMenu" class="share-menu" role="menu" aria-label="共有メニュー"></div>

        <div class="grid">
          <div class="cell"><div class="k">参考幅</div><div id="range" class="v">—</div></div>
          <div class="cell"><div class="k">係数</div><div id="factor" class="v">—</div></div>
          <div class="cell"><div class="k">計算に使った式</div><div id="formula" class="v">RER=70×体重^0.75</div></div>
          <div class="cell" style="grid-column:1/-1"><div class="k">メモ</div><div id="note" class="v">—</div></div>
        </div>
      </div>
    </section>

    <!-- FAQ（常時表示） -->
    <section class="section" aria-labelledby="faqTitle">
      <h2 id="faqTitle" class="section-title">よくある質問</h2>
      <div>
        <details>
          <summary>どうやって計算しているの？ <svg class="chev" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#444" stroke-width="1.5"><path d="M6 9l6 6 6-6"/></svg></summary>
          <div class="muted" style="margin-top:8px">
            体重からRER（安静時必要量）=<code>70 × 体重^0.75</code>を出し、<b>ライフステージ・目標・去勢の有無</b>に応じた係数を掛けて1日の必要カロリーを求めます。<br>
            むずかしい専門設定はなし。かわりに<strong>中心値＋参考幅</strong>を出して、体格差や生活の差を吸収します。
          </div>
        </details>
        <details>
          <summary>参考幅って何？どう使うの？ <svg class="chev" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#444" stroke-width="1.5"><path d="M6 9l6 6 6-6"/></svg></summary>
          <div class="muted" style="margin-top:8px">
            体格（やせ気味/太り気味）や活動量の違いで、必要カロリーは増減します。その幅をあらかじめ表示しています。<br>
            まずは<strong>中心値</strong>で始め、<b>週1〜2回の体重記録</b>を。増え続け/減り続ける場合は<strong>5〜10%</strong>ずつ上下して調整しましょう。
          </div>
        </details>
        <details>
          <summary>去勢/避妊はどんな影響がある？ <svg class="chev" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#444" stroke-width="1.5"><path d="M6 9l6 6 6-6"/></svg></summary>
          <div class="muted" style="margin-top:8px">
            成猫では一般に、<b>未去勢</b>より<b>去勢/避妊済み</b>のほうが必要カロリーが低くなりがちです（係数の目安：未去勢1.4、去勢済1.2）。<br>
            本ツールでは成猫のときだけトグルが表示され、中心値と参考幅に反映されます。
          </div>
        </details>
      </div>
    </section>

    <footer class="section">© <span id="year"></span> CAT LINK tools</footer>
  </main>

  <!-- FAQ 構造化データ（簡易） -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"どうやって計算しているの？","acceptedAnswer":{"@type":"Answer","text":"体重からRER=70×体重^0.75を出し、ライフステージ・目標・去勢の有無に応じた係数を掛けて1日の必要カロリーを求めます。専門設定は不要で、中心値＋参考幅を表示します。"}},
      {"@type":"Question","name":"参考幅って何？どう使うの？","acceptedAnswer":{"@type":"Answer","text":"体格や活動量の違いで必要カロリーは増減します。その幅をあらかじめ表示。まずは中心値で始め、週1〜2回の体重記録を行い、5〜10%ずつ微調整しましょう。"}},
      {"@type":"Question","name":"去勢/避妊はどんな影響がある？","acceptedAnswer":{"@type":"Answer","text":"成猫では一般に未去勢より去勢/避妊済みのほうが必要カロリーが低め（係数目安：未去勢1.4、去勢済1.2）。トグルは成猫時のみ表示され、中心値と参考幅に反映します。"}}
    ]
  }
  </script>

  <script>
    // ===== ユーティリティ =====
    const $ = (s)=>document.querySelector(s);
    $('#year').textContent = String(new Date().getFullYear());
    const toast = document.createElement('div'); toast.className='toast'; document.body.appendChild(toast);
    function showToast(msg){ toast.textContent=msg; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 1600); }

    // ===== 入力参照 =====
    const w = $('#w');
    const segStageBtns = document.querySelectorAll('.seg-btn[data-stage]');
    const segGoalBtns  = document.querySelectorAll('.seg-btn[data-goal]');
    const neuteredWrap = $('#neuteredWrap');
    const neutered = $('#neutered');
    const errEl = $('#error');

    // ===== 出力参照 =====
    const kcalEl = $('#kcal'), rangeEl = $('#range'), factorEl = $('#factor'), noteEl = $('#note');

    // ===== 共有 =====
    const shareBtn = $('#shareBtn'), shareMenu = $('#shareMenu');
    shareBtn.addEventListener('click', (e)=>{ e.stopPropagation(); toggleShare(); });
    document.addEventListener('click', (e)=> {
      if (!shareMenu.contains(e.target) && e.target !== shareBtn) toggleShare(false);
    });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') toggleShare(false); });

    function iconX(){ return `<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M18.2 3h2.4l-5.2 5.9L22 21h-4.8l-3.7-7-4.2 4.8V21H4V3h5.3v7.5L18.2 3z"/></svg>`;}
    function iconShare(){ return `<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M4 12v7a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-7"/><path d="M12 16V4"/><path d="M8 8l4-4 4 4"/></svg>`;}
    function iconLink(){ return `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" aria-hidden="true"><path d="M10 13a5 5 0 0 1 0-7l1.5-1.5a5 5 0 0 1 7 7L17 12"/><path d="M14 11a5 5 0 0 1 0 7L12.5 19.5a5 5 0 1 1-7-7L7 12"/></svg>`;}

    function buildShareMenu(){
      shareMenu.innerHTML = '';
      const url = new URL(location.href).toString();
      const k = kcalEl.textContent;
      const r = rangeEl.textContent;
      const text = (k !== '--' && r !== '—')
        ? `うちの猫の必要カロリーは「${k}（${r}）」でした🐾`
        : `猫のカロリーを計算しました🐾`;

      if (navigator.share){
        const btnShare = document.createElement('button');
        btnShare.className='share-item';
        btnShare.innerHTML = iconShare() + '<span>この結果を共有</span>';
        btnShare.addEventListener('click', async () => {
          try { await navigator.share({ title: '猫のカロリー計算', text, url }); } catch(e){}
          toggleShare(false);
        });
        shareMenu.appendChild(btnShare);
      }

      const btnX = document.createElement('a');
      btnX.className='share-item';
      btnX.href = `https://x.com/intent/post?${new URLSearchParams({url, text}).toString()}`;
      btnX.target = '_blank'; btnX.rel='noopener';
      btnX.innerHTML = iconX() + '<span>Xでシェア</span>';
      btnX.addEventListener('click', ()=> toggleShare(false));
      shareMenu.appendChild(btnX);

      const btnCopy = document.createElement('button');
      btnCopy.className='share-item';
      btnCopy.innerHTML = iconLink() + '<span>リンクをコピー</span>';
      btnCopy.addEventListener('click', async () => {
        await navigator.clipboard.writeText(url);
        showToast('リンクをコピーしました');
        toggleShare(false);
      });
      shareMenu.appendChild(btnCopy);
    }
    function toggleShare(open){
      if (typeof open === 'undefined') open = !shareMenu.classList.contains('open');
      shareMenu.classList.toggle('open', open);
      shareBtn.setAttribute('aria-expanded', String(open));
      if (open) buildShareMenu();
    }

    // ===== 計算ロジック（シンプル版：中心値＋参考幅） =====
    function RER(weight){ return 70 * Math.pow(weight, 0.75); }

    // ステージ/目標/去勢 から 係数の中心値と幅（min,max）を返す
    function pickFactorSimple(stage, goal, neutered){
      // goalが最優先（減量/増量）
      if (goal === 'loss')   return {center:0.85, min:0.8, max:1.0, label:'減量の目安'};
      if (goal === 'gain')   return {center:1.3,  min:1.2, max:1.4, label:'増量の目安'};
      // 維持
      if (stage === 'kitten') return {center:2.5, min:2.0, max:3.0, label:'子猫の成長'};
      if (stage === 'senior') return {center:1.2, min:1.1, max:1.4, label:'シニアの目安'};
      // 成猫
      if (neutered) return {center:1.2, min:1.0, max:1.6, label:'成猫・去勢/避妊済'};
      return {center:1.4, min:1.2, max:1.6, label:'成猫・未去勢/未避妊'};
    }

    // 状態
    const state = {
      stage: 'adult',    // 'kitten'|'adult'|'senior'
      goal:  'maintain', // 'maintain'|'loss'|'gain'
      neutered: true
    };

    function setSegPressed(list, target){
      list.forEach(btn => btn.setAttribute('aria-pressed', String(btn === target)));
    }
    function applyNeuteredVisibility(){
      const show = (state.stage === 'adult');
      neuteredWrap.hidden = !show;
      neutered.disabled = !show;
    }

    // イベント
    segStageBtns.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        state.stage = btn.dataset.stage;
        setSegPressed(segStageBtns, btn);
        applyNeuteredVisibility();
        update();
      });
    });
    segGoalBtns.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        state.goal = btn.dataset.goal;
        setSegPressed(segGoalBtns, btn);
        update();
      });
    });
    neutered.addEventListener('change', ()=>{ state.neutered = neutered.checked; update(); });

    // URL復元
    (function restore(){
      const p = new URLSearchParams(location.search);
      if (p.get('w')) w.value = p.get('w');
      if (p.get('s')) {
        state.stage = p.get('s');
        const b=[...segStageBtns].find(x=>x.dataset.stage===state.stage);
        if (b) setSegPressed(segStageBtns,b);
      }
      if (p.get('g')) {
        state.goal  = p.get('g');
        const b=[...segGoalBtns].find(x=>x.dataset.goal===state.goal);
        if (b) setSegPressed(segGoalBtns,b);
      }
      if (p.get('n')) {
        state.neutered = (p.get('n')==='1');
        neutered.checked = state.neutered;
      }
      applyNeuteredVisibility();
      update();
    })();

    // 入力イベント
    w.addEventListener('input', update);

    // 計算 & 反映
    function update(){
      errEl.textContent = '';
      const weight = parseFloat(w.value);
      if (!(weight>0)) { setResult('--','—','—','—'); syncURL(); return; }
      if (weight < 0.5 || weight > 12) errEl.textContent = '体重が一般的な範囲を外れています（0.5〜12kg目安）。結果はあくまで参考に。';

      const rer = RER(weight);
      const f = pickFactorSimple(state.stage, state.goal, state.neutered);
      const center = rer * f.center;
      const min    = rer * f.min;
      const max    = rer * f.max;

      setResult(
        round1(center)+'',
        `${round1(min)}〜${round1(max)} kcal/日`,
        `× ${f.center.toFixed(2)}（${f.label}）`,
        noteFor(state)
      );
      syncURL();
    }

    function setResult(kcal, range, factor, note){
      kcalEl.textContent = kcal;
      rangeEl.textContent = range;
      factorEl.textContent = factor;
      noteEl.textContent = note;
    }
    function noteFor(s){
      if (s.goal==='loss') return '減量はゆっくりが安全。1〜2週ごとに体重を確認し、与える量を5〜10%ずつ調整しましょう。';
      if (s.goal==='gain') return '増量は体調を見ながら少しずつ。食欲や活動量の変化も併せて確認を。';
      if (s.stage==='kitten') return '子猫は月齢で必要量が変わります。月齢が進むにつれて少しずつ減らしていきます。';
      if (s.stage==='senior') return 'シニアは個体差が大きい時期。体重・食欲・飲水をこまめに観察しましょう。';
      return 'まずは中心値で始め、週1〜2回の体重記録で5〜10%ずつ微調整するのがおすすめ。';
    }
    function round1(x){ return Math.round(x*10)/10; }
    function syncURL(){
      const url = new URL(location.href);
      url.searchParams.set('w', w.value || '');
      url.searchParams.set('s', state.stage);
      url.searchParams.set('g', state.goal);
      url.searchParams.set('n', state.neutered ? '1':'0');
      history.replaceState(null,'',url);
    }

    // 共有メニュー
    function buildShareMenu(){
      shareMenu.innerHTML = '';
      const url = new URL(location.href).toString();
      const k = kcalEl.textContent;
      const r = rangeEl.textContent;
      const text = (k !== '--' && r !== '—')
        ? `うちの猫の必要カロリーは「${k}（${r}）」でした🐾`
        : `猫のカロリーを計算しました🐾`;

      if (navigator.share){
        const btnShare = document.createElement('button');
        btnShare.className='share-item';
        btnShare.innerHTML = iconShare() + '<span>この結果を共有</span>';
        btnShare.addEventListener('click', async () => {
          try { await navigator.share({ title: '猫のカロリー計算', text, url }); } catch(e){}
          toggleShare(false);
        });
        shareMenu.appendChild(btnShare);
      }

      const btnX = document.createElement('a');
      btnX.className='share-item';
      btnX.href = `https://x.com/intent/post?${new URLSearchParams({url, text}).toString()}`;
      btnX.target = '_blank'; btnX.rel='noopener';
      btnX.innerHTML = iconX() + '<span>Xでシェア</span>';
      btnX.addEventListener('click', ()=> toggleShare(false));
      shareMenu.appendChild(btnX);

      const btnCopy = document.createElement('button');
      btnCopy.className='share-item';
      btnCopy.innerHTML = iconLink() + '<span>リンクをコピー</span>';
      btnCopy.addEventListener('click', async () => {
        await navigator.clipboard.writeText(url);
        showToast('リンクをコピーしました');
        toggleShare(false);
      });
      shareMenu.appendChild(btnCopy);
    }
    function toggleShare(open){
      if (typeof open === 'undefined') open = !shareMenu.classList.contains('open');
      shareMenu.classList.toggle('open', open);
      shareBtn.setAttribute('aria-expanded', String(open));
      if (open) buildShareMenu();
    }

    // 初期描画
    applyNeuteredVisibility();
    update();
  </script>
</body>
</html>
