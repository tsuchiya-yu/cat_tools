---
name: cat-tools-gh-pr-review-autopilot
description: cat_tools リポジトリで、PR URL を起点に gh CLI を使ったレビュー指摘対応フロー（未解決スレッド取得、妥当性判断、修正、push、返信投稿）を実行する。判定に迷う場合は必ずユーザーへ確認し、回答が揃うまで停止する。
---

# cat-tools-gh-pr-review-autopilot

このリポジトリの GitHub PR URL を受け取ったとき、次の手順で実行する。

## 実行前提（パス解決）

- `scripts/` と `references/` は、**skill ディレクトリ基準**で参照する。
- 基本は `SKILL.md` と同じ階層を基準に、`scripts/intake_pr.sh` / `scripts/preflight_check.sh` / `references/question-checklist.md` を読む。
- リポジトリ直下（`<repo>/scripts` など）に同名ファイルがあっても、まずは skill ディレクトリ側を優先する。

## 必須フロー

1. `scripts/intake_pr.sh <pr-url>` で PR と未解決スレッドを取得して要約する。
2. `scripts/preflight_check.sh <pr-url>` で事前チェックを行う。
3. `references/question-checklist.md` で不明点を判定する。
4. 必須項目に未確定事項があれば、短く具体的な質問を行い、実装を停止する。
5. 未解決スレッドごとに、指摘の妥当性を判断する。
6. 指摘が妥当な場合のみ最小変更で修正し、既存ブランチへ commit / push する。
7. 各スレッドへ `gh` CLI で返信を自動投稿する。
8. 返信投稿後、該当スレッドを解決済みに更新する。

## 分岐ルール

- 指摘が正しい場合:
  - コード修正を行う。
  - 修正を既存ブランチへ push する。
  - スレッドへ返信を自動投稿する。
- 指摘が誤り/不明瞭な場合:
  - コード修正は行わない。
  - スレッドへ質問または指摘根拠の確認依頼を自動投稿する。
- 判定に迷う場合（複数解決策・仕様衝突・影響範囲が大きい場合）:
  - 実施前にユーザーへ相談し、回答が得られるまで停止する。

## 返信フォーマット（厳守）

- 1行目: `@<reviewer>`
- 2行目以降:
  - 修正した場合: 修正概要 + 再確認依頼
  - 修正しない場合: 質問または根拠確認依頼

## 厳守ルール

- PR / レビュー操作は `gh` CLI を使う。
- 未解決スレッドのみを対象にする。解決済みスレッドには触れない。
- 不明点が残っている状態で実装を開始しない。
- 新規ブランチは作成しない。既存ブランチ運用を守る。
- 破壊的 git 操作（`reset --hard` など）を行わない。
- リポジトリに無関係なローカル変更がある場合でも、勝手に巻き戻さない。

## デフォルト方針（未指定時はこれを採用）

- 検証方法:
  - 必ず `npm run lint` と `npm run test` を実行する。
  - 画面変更（UI/文言/スタイル/構造化データ表示含む）がある場合、Playwright MCP で対象ページのキャプチャを取得する。
- 制約:
  - 原則として、レビュー指摘対応に必要な最小変更のみ行う。
  - 無関係なリファクタ・命名変更・ファイル移動・整形のみ変更は行わない。

## 追加ルール（質問の抑制）

- `検証方法` は上記デフォルトが適用可能なら未確認でも進める。
- `制約` は上記デフォルト（最小変更）が適用可能なら未確認でも進める。
- ただし、PR本文やレビューコメントで明示された要件がデフォルト方針と衝突する場合は、明示要件を優先する。

## リソース

- PR 取得と要約: `scripts/intake_pr.sh`
- 事前チェック: `scripts/preflight_check.sh`
- 不明点チェックリスト: `references/question-checklist.md`
